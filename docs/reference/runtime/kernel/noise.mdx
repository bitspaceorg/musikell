---
title: "Noise Kernels"
description: "White, pink, and brown noise generators using xorshift PRNG"
author: "rahulmnavneeth"
date: "16 FEB 2026"
slug: "reference-runtime-kernel-noise"
tags: ["reference", "runtime", "kernel", "noise"]
source: "src/Musikell/Runtime/Kernel/Builtin/Noise.hs"
---

## Purpose

Noise generator kernels with three spectral profiles: white (flat), pink (-3 dB/octave), and brown (-6 dB/octave). All use xorshift32 PRNG for zero-allocation random number generation.

**Module:** `Musikell.Runtime.Kernel.Builtin.Noise`

---

## `mkWhiteNoise`

**KernelId:** `"noise.white"`
**Inputs:** 0 | **Outputs:** 1 | **Stateful:** Yes (PRNG state IORef)

```haskell
mkWhiteNoise :: Word32 -> IO KernelSpec
```

### Parameters

| Parameter | Type     | Description                         |
| --------- | -------- | ----------------------------------- |
| `seed`    | `Word32` | PRNG seed. If 0, defaults to 12345. |

### Behavior

Each sample is an independent random value in [-1, 1] generated by xorshift32. Flat spectral density (equal energy per frequency).

---

## `mkPinkNoise`

**KernelId:** `"noise.pink"`
**Inputs:** 0 | **Outputs:** 1 | **Stateful:** Yes (PRNG state, 8 octave bands, counter IORefs)

```haskell
mkPinkNoise :: Word32 -> IO KernelSpec
```

### Parameters

| Parameter | Type     | Description                         |
| --------- | -------- | ----------------------------------- |
| `seed`    | `Word32` | PRNG seed. If 0, defaults to 67890. |

### Behavior

Voss-McCartney algorithm with 8 octave bands. Each sample:

1. Count trailing zeros of a running counter to determine which octave band to update
2. Generate a new white noise sample and replace that band's running value
3. Sum all 8 bands and normalize by 1/8

Spectral density falls at -3 dB/octave (1/f noise). Useful for natural-sounding modulation and testing.

---

## `mkBrownNoise`

**KernelId:** `"noise.brown"`
**Inputs:** 0 | **Outputs:** 1 | **Stateful:** Yes (PRNG state, accumulator IORefs)

```haskell
mkBrownNoise :: Word32 -> IO KernelSpec
```

### Parameters

| Parameter | Type     | Description                         |
| --------- | -------- | ----------------------------------- |
| `seed`    | `Word32` | PRNG seed. If 0, defaults to 54321. |

### Behavior

Integrated white noise with leaky accumulator:

```
white = xorshift() * 0.1     -- scaled step
accum = (accum + white) * 0.998  -- leaky integration
output = clamp(accum, -1, 1)  -- soft clamp
```

Spectral density falls at -6 dB/octave (Brownian motion / random walk). The leak factor (0.998) prevents DC drift, and soft clamping keeps output in [-1, 1].

---

## Internal: `xorshift`

```haskell
xorshift :: Word32 -> Word32
```

Fast xorshift32 PRNG with period 2^32 - 1. Marked `INLINE`. Three-step shift-XOR sequence.

### Internal: `toFloat`

```haskell
toFloat :: Word32 -> Float
```

Convert `Word32` to `Float` in [-1, 1] by interpreting as signed integer and dividing by 2^31. Marked `INLINE`.

## Example

```mkl
noise.white(42) -> gain(0.3) -> output
noise.pink(0) -> filter.lowpass(500, 0.5) -> output
noise.brown(99) -> output
```

## Usage Notes

- All noise kernels are stateful and must be created via their `mk*` constructors. Not included in `builtinRegistry`.
- Seed value of 0 is replaced with a non-zero default (xorshift requires non-zero state).
- Pink noise uses a list of 8 `Float` values for octave bands, which is updated per sample. This is a known performance concern due to list allocation.
- Brown noise output is clamped to [-1, 1] to prevent unbounded drift.
